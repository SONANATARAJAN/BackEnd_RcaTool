<queries>
    <query id="fetchLsi">
        SELECT problemid, objecttype, objectid, objectname, mrmtid, mimtid, additionalinfo
        FROM rca_problem
        WHERE problemid IN (
        SELECT problemid FROM rca_prob_child_event
        WHERE childrciid IN (
        SELECT id FROM rca_rci WHERE objectname = :lsiId
        )
        )
    </query>

    <query id="compareQuery">
        SELECT DISTINCT
        r1.objecttype AS COL1, r1.eventtypespecificuniquekey AS COL2, r1.mrmtId AS COL3,
        r1.referobjtype AS COL4, r1.sourceofrci AS COL5,
        CASE
        WHEN r1.additionalinfo IS NOT NULL
        AND REPLACE(REPLACE(LOWER(r1.additionalinfo), CHR(10), ''), CHR(13), '') LIKE '%layerrate=%'
        THEN r1.additionalinfo
        ELSE NULL
        END AS COL6,
        r2.objecttype AS COL7, r2.eventtypespecificuniquekey AS COL8, r2.mrmtId AS COL9, r2.referobjtype AS COL10, r2.sourceofrci AS COL11,
        CASE
        WHEN r2.additionalinfo IS NOT NULL
        AND REPLACE(REPLACE(LOWER(r2.additionalinfo), CHR(10), ''), CHR(13), '') LIKE '%layerrate=%'
        THEN r2.additionalinfo
        ELSE NULL
        END AS COL12,
        h.srcofrelationship AS COL13, h.relationshiptype AS COL14
        FROM RCA_HIER_HIS_RCI_12_8_2025 h
        JOIN rca_rci r1 ON h.parentid = r1.id
        JOIN rca_rci r2 ON h.childid = r2.id
    </query>

</queries>

